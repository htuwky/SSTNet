

# SSTNet: Spatial-Spectral Temporal Network for Eye-Tracking Classification



**SSTNet** æ˜¯ä¸€ä¸ªåŸºäºæ·±åº¦å­¦ä¹ çš„å¤šæ¨¡æ€åˆ†ç±»æ¡†æ¶ï¼Œä¸“é—¨ç”¨äºå¤„ç†çœ¼åŠ¨è¿½è¸ªæ•°æ®ï¼ˆEye-Tracking Dataï¼‰ã€‚è¯¥é¡¹ç›®æ—¨åœ¨é€šè¿‡ç»“åˆå—è¯•è€…çš„**æ³¨è§†è¡Œä¸ºï¼ˆæ—¶åºç”Ÿç†ç‰¹å¾ï¼‰å’Œæ³¨è§†å†…å®¹ï¼ˆç©ºé—´è§†è§‰ç‰¹å¾ï¼‰**ï¼Œæ¥è¾…åŠ©è¯Šæ–­ç²¾ç¥ç–¾ç—…ï¼ˆå¦‚åŒºåˆ†ç²¾ç¥åˆ†è£‚ç—‡ SZ ä¸å¥åº·å¯¹ç…§ç»„ HCï¼‰ã€‚



## ğŸ“– é¡¹ç›®æ ¸å¿ƒæ¶æ„



æ¨¡å‹é‡‡ç”¨ **åŒæµæ¶æ„ (Two-Stream Architecture)**ï¼š

1. **æ—¶åºæµ (Temporal Stream)**: ä½¿ç”¨ **Transformer** å¤„ç†æ³¨è§†ç‚¹åºåˆ—çš„æ—¶åºé€»è¾‘ï¼Œèåˆäº†åæ ‡ (X, Y)ã€æ³¨è§†æ—¶é•¿ã€ç³å­”å¤§å°ç­‰ç”Ÿç†ç‰¹å¾ã€‚
2. **ç©ºé—´æµ (Spatial Stream)**: ä½¿ç”¨ **NetVLAD** æ•æ‰æ³¨è§†åŒºåŸŸçš„è§†è§‰è¯­ä¹‰åˆ†å¸ƒï¼ŒåŸºäº CLIP æå–çš„å›¾åƒç‰¹å¾è¿›è¡Œèšç±»åˆ†æã€‚

------



## ğŸ› ï¸ ç¯å¢ƒä¾èµ– (Requirements)



è¯·ç¡®ä¿å®‰è£…ä»¥ä¸‹ Python åº“ï¼š

- **Python** >= 3.8
- **PyTorch** (å»ºè®® GPU ç‰ˆæœ¬)
- **CLIP** (`pip install git+https://github.com/openai/CLIP.git`)
- **WandB** (ç”¨äºå®éªŒè®°å½•ä¸å¯è§†åŒ–)
- **Pandas**, **NumPy**, **Tqdm**, **Scikit-learn**, **Matplotlib**, **OpenPyXL**

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…åŸºç¡€ä¾èµ–ï¼š

Bash

```
pip install torch torchvision pandas numpy tqdm scikit-learn matplotlib wandb openpyxl
pip install git+https://github.com/openai/CLIP.git
```

------



## ğŸ“‚ é¡¹ç›®ç»“æ„ (File Structure)



Plaintext

```
SSTNet/
â”œâ”€â”€ config.py                   # å…¨å±€é…ç½®æ–‡ä»¶ (è·¯å¾„ã€è¶…å‚æ•°ã€æ¨¡å‹å‚æ•°)
â”œâ”€â”€ train.py                    # è®­ç»ƒä¸»è„šæœ¬
â”œâ”€â”€ check_env.py                # ç¯å¢ƒè‡ªæ£€è„šæœ¬
â”œâ”€â”€ data_process/               # æ•°æ®é¢„å¤„ç†å·¥å…·åŒ…
â”‚   â”œâ”€â”€ split_fix.py            # [æ­¥éª¤1] å°†åŸå§‹ Excel æ¸…æ´—å¹¶æ‹†åˆ†ä¸º TXT åºåˆ—
â”‚   â”œâ”€â”€ generate_clip_features.py # [æ­¥éª¤2] æå–æ³¨è§†ç‚¹å¤„çš„ CLIP è§†è§‰ç‰¹å¾ (.npy)
â”‚   â”œâ”€â”€ check_fixation_stats.py # ç»Ÿè®¡åºåˆ—é•¿åº¦åˆ†å¸ƒï¼Œè¾…åŠ©è®¾å®š MAX_SEQ_LEN
â”‚   â”œâ”€â”€ check_data_stats.py     # ç»Ÿè®¡æ•°æ®åˆ†å¸ƒï¼Œç”¨äºå½’ä¸€åŒ–å‚æ•°è®¡ç®—
â”‚   â””â”€â”€ inspect_npy.py          # æ£€æŸ¥ç”Ÿæˆçš„ç‰¹å¾æ–‡ä»¶å†…å®¹
â”œâ”€â”€ models/                     # æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ sstnet.py               # SSTNet ä¸»æ¨¡å‹ (è´Ÿè´£ç»„è£…åŒæµ)
â”‚   â”œâ”€â”€ temporal_stream.py      # æ—¶åºæµ (Transformer)
â”‚   â””â”€â”€ spatial_stream.py       # ç©ºé—´æµ (NetVLAD)
â”œâ”€â”€ utils/                      # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ dataloader.py           # æ•°æ®åŠ è½½å™¨ (Dataset & DataLoader)
â”‚   â”œâ”€â”€ loss.py                 # æŸå¤±å‡½æ•° (Focal Loss)
â”‚   â”œâ”€â”€ metrics.py              # è¯„ä»·æŒ‡æ ‡ (AUC, ACC, F1ç­‰)
â”‚   â””â”€â”€ misc.py                 # æ‚é¡¹ (éšæœºç§å­å›ºå®š, æ¨¡å‹ä¿å­˜)
â””â”€â”€ dataset/                    # æ•°æ®å­˜æ”¾ç›®å½• (éœ€è‡ªè¡Œå»ºç«‹)
    â”œâ”€â”€ Images/                 # åŸå§‹å›¾ç‰‡ç´ æ
    â”œâ”€â”€ Train_Valid/            # è®­ç»ƒä¸éªŒè¯æ•°æ®
    â”‚   â”œâ”€â”€ Fixations/          # åŸå§‹çœ¼åŠ¨ Excel æ–‡ä»¶
    â”‚   â””â”€â”€ TXT/                # ç”Ÿæˆçš„æ¸…æ´—å TXT æ–‡ä»¶
    â””â”€â”€ output/                 # ç‰¹å¾æå–è¾“å‡ºç›®å½•
```

------



## ğŸš€ ä½¿ç”¨æŒ‡å— (Usage Pipeline)



è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ•°æ®å‡†å¤‡å’Œè®­ç»ƒã€‚



### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡åŸå§‹æ•°æ®



å°†åŸå§‹æ•°æ®æ”¾å…¥ `config.py` æŒ‡å®šçš„ç›®å½•ä¸­ï¼š

1. **å›¾ç‰‡æ–‡ä»¶**: æ”¾å…¥ `dataset/Images/` (æ”¯æŒ .jpg, .png ç­‰)ã€‚
2. **çœ¼åŠ¨æ•°æ®**: æ”¾å…¥ `dataset/Train_Valid/Fixations/` (åŸå§‹ Excel æ–‡ä»¶)ã€‚
3. **åˆ’åˆ†è¡¨**: ç¡®ä¿ `dataset/Train_Valid.xlsx` å­˜åœ¨ï¼ˆç”¨äºäº¤å‰éªŒè¯åˆ’åˆ†ï¼‰ã€‚



### ç¬¬äºŒæ­¥ï¼šæ•°æ®æ¸…æ´—ä¸åºåˆ—åŒ–



è¿è¡Œ `split_fix.py`ï¼Œå°†ä»¥â€œå—è¯•è€…â€ä¸ºå•ä½çš„ Excel æ•°æ®æ‹†è§£ä¸ºä»¥â€œå—è¯•è€…_å›¾ç‰‡â€ä¸ºå•ä½çš„ `.txt` åºåˆ—æ–‡ä»¶ï¼Œå¹¶æ¸…æ´—è¶Šç•Œåæ ‡ã€‚

Bash

```
python data_process/split_fix.py --dataset_dir dataset
```

- **è¾“å‡º**: `dataset/Train_Valid/TXT/*.txt`
- **å†…å®¹**: æ¯è¡ŒåŒ…å« `Index, X, Y, Duration, Pupil`ã€‚



### ç¬¬ä¸‰æ­¥ï¼šæå–è§†è§‰ç‰¹å¾ (CLIP)



è¿è¡Œ `generate_clip_features.py`ã€‚è¯¥è„šæœ¬ä¼šæ¨¡æ‹Ÿäººçœ¼è§†é‡ï¼Œæ ¹æ®æ³¨è§†ç‚¹åæ ‡è£å‰ªå›¾ç‰‡å±€éƒ¨ï¼ˆCropï¼‰ï¼Œå¹¶ä½¿ç”¨ CLIP æå–ç‰¹å¾ã€‚

Bash

```
python data_process/generate_clip_features.py
```

- **è¾“å‡º**: `dataset/output/feature_dict_CLIP.npy`
- **è¯´æ˜**: è¿™æ˜¯ä¸€ä¸ªå­—å…¸æ–‡ä»¶ï¼ŒKey ä¸ºæ–‡ä»¶åï¼ŒValue ä¸º `[Seq_Len, 512]` çš„ç‰¹å¾çŸ©é˜µã€‚



### (å¯é€‰) ç¬¬å››æ­¥ï¼šæ•°æ®åˆ†æä¸é…ç½®æ›´æ–°



è¿è¡Œç»Ÿè®¡è„šæœ¬ä»¥ç¡®å®šæœ€ä½³è¶…å‚æ•°ï¼ˆå¦‚åºåˆ—é•¿åº¦ã€å½’ä¸€åŒ–è¾¹ç•Œï¼‰ã€‚

- `python data_process/check_fixation_stats.py`: æŸ¥çœ‹åºåˆ—é•¿åº¦åˆ†å¸ƒã€‚
- `python data_process/check_data_stats.py`: æŸ¥çœ‹ç”Ÿç†æ•°æ®çš„ Min/Max/Mean/Stdã€‚
  - **æ³¨æ„**: å¦‚æœç»Ÿè®¡å‡ºçš„æ•°å€¼èŒƒå›´ä¸ `config.py` ä¸­çš„é»˜è®¤å€¼å·®å¼‚è¾ƒå¤§ï¼Œè¯·æ‰‹åŠ¨æ›´æ–° `config.py` ä¸­çš„ `SCREEN_X_MIN`, `DUR_MAX` ç­‰å‚æ•°ã€‚



### ç¬¬äº”æ­¥ï¼šæ¨¡å‹è®­ç»ƒ



è¿è¡Œ `train.py` å¼€å§‹è®­ç»ƒã€‚æ”¯æŒ K-Fold äº¤å‰éªŒè¯ï¼ˆé»˜è®¤ä¸º 4 æŠ˜ï¼‰ã€‚

Bash

```
# è®­ç»ƒç¬¬ 0 æŠ˜ (Fold 0)
python train.py --fold 0

# è®­ç»ƒç¬¬ 1 æŠ˜ (Fold 1)
python train.py --fold 1
```

- **ç›‘æ§**: è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨è¿æ¥ WandB è®°å½• Loss å’Œ AUC æ›²çº¿ã€‚
- **æ¨¡å‹ä¿å­˜**: æœ€ä½³æ¨¡å‹å°†ä¿å­˜åœ¨ `checkpoints/` ç›®å½•ä¸‹ã€‚

------



## âš™ï¸ é…ç½®æ–‡ä»¶ (Config)



æ‰€æœ‰å…³é”®å‚æ•°å‡åœ¨ `config.py` ä¸­ç®¡ç†ï¼Œå¸¸ç”¨ä¿®æ”¹é¡¹å¦‚ä¸‹ï¼š

- **æ•°æ®è·¯å¾„**: `DATASET_DIR`, `IMAGE_DIR`, `TXT_DIR`
- **æ¨¡å‹å‚æ•°**:
  - `MAX_SEQ_LEN = 32`: åºåˆ—æœ€å¤§é•¿åº¦ï¼ˆè¶…è¿‡æˆªæ–­ï¼Œä¸è¶³è¡¥0ï¼‰ã€‚
  - `SPATIAL_CLUSTERS = 8`: NetVLAD çš„èšç±»ä¸­å¿ƒæ•°ã€‚
- **è®­ç»ƒå‚æ•°**:
  - `BATCH_SIZE = 64`
  - `LEARNING_RATE = 1e-4`
  - `EPOCHS = 100`

------



## ğŸ§  æ¨¡å‹ç»†èŠ‚



1. **æ•°æ®åŠ è½½ (`utils/dataloader.py`)**:
   - è¯»å– `.txt` ä¸­çš„ç”Ÿç†æ•°æ®ï¼Œè¿›è¡Œ Min-Max å½’ä¸€åŒ–ï¼ˆæ˜ å°„åˆ° -1~1ï¼‰ã€‚
   - è¯»å– `.npy` ä¸­çš„è§†è§‰ç‰¹å¾ã€‚
   - ç”Ÿæˆ `Mask` æ©ç ï¼Œæ ‡è®°çœŸå®æ•°æ®ä¸ Padding æ•°æ®ã€‚
   - æ ‡ç­¾é€»è¾‘ï¼šSubject ID < 200 è§†ä¸º HC (0)ï¼Œ>= 200 è§†ä¸º SZ (1)ã€‚
2. **æŸå¤±å‡½æ•° (`utils/loss.py`)**:
   - ä½¿ç”¨ **Focal Loss** è§£å†³æ­£è´Ÿæ ·æœ¬ä¸å¹³è¡¡é—®é¢˜ã€‚
3. **ä¸»è¦åˆ›æ–°ç‚¹**:
   - **Look where humans look**: ä¸ä½¿ç”¨å…¨å›¾ç‰¹å¾ï¼Œè€Œæ˜¯åˆ©ç”¨çœ¼åŠ¨åæ ‡æå–å±€éƒ¨ CLIP ç‰¹å¾ã€‚
   - **Masked Attention**: åœ¨ Transformer å’Œ NetVLAD ä¸­å‡ä¸¥æ ¼å¤„ç†äº† Maskï¼Œæ¶ˆé™¤å¡«å……æ•°æ®å¯¹æ¨¡å‹åˆ¤æ–­çš„å¹²æ‰°ã€‚